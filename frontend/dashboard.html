<!DOCTYPE html>
<html>
<head>
<title>Dashboard - AutoGest</title>
<style>
body {
    margin:0;
    background:#1a1a2e;
    font-family:Arial;
    color:white;
}
.sidebar {
    width:220px;
    height:100vh;
    background:#16213e;
    position:fixed;
    padding:20px;
}
.sidebar h2 { color:#e94560; }
.sidebar p { cursor: pointer; padding: 10px 0; border-bottom: 1px solid #0f3460; }
.sidebar p:hover { color: #e94560; }

.main {
    margin-left:260px;
    padding:40px;
}

.card {
    background:#0f3460;
    padding:20px;
    border-radius:10px;
    width:200px;
    display:inline-block;
    margin:15px;
    text-align:center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.card h3 { margin:0; font-size:24px; color: #e94560; }
.card p { margin:10px 0 0; color: #ccc; }

.loading { text-align: center; font-size: 20px; margin-top: 50px; }
</style>
</head>

<body>

<div class="sidebar">
    <h2>AutoGest</h2>
    <p onclick="location.reload()">ðŸ”„ Dashboard</p>
    <p>ðŸš— VeÃ­culos</p>
    <p>ðŸ“„ RENAVE</p>
    <p onclick="logout()" style="color: #ff4d6d; margin-top: 20px;">ðŸšª Sair</p>
</div>

<div class="main">
    <h1>Dashboard</h1>
    <div id="cards" class="loading">Carregando dados do servidor...</div>
</div>

<script>
// URL oficial do seu backend no Render
const API_URL = "https://autogest-backend-ikmb.onrender.com";

async function carregarDashboard(){
    const token = localStorage.getItem("token"); // Busca o token salvo no login

    // Se nÃ£o houver token, redireciona para o login por seguranÃ§a
    if (!token) {
        window.location.href = "login.html";
        return;
    }

    try {
        const res = await fetch(`${API_URL}/dashboard`, {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`, // Envia a credencial para o Render liberar os dados
                "Content-Type": "application/json"
            }
        });

        if (res.status === 401) {
            alert("SessÃ£o expirada. FaÃ§a login novamente.");
            logout();
            return;
        }

        const data = await res.json();

        document.getElementById("cards").innerHTML = `
            <div class="card">
                <h3>${data.total_veiculos || 0}</h3>
                <p>Total VeÃ­culos</p>
            </div>

            <div class="card">
                <h3>${data.em_estoque || 0}</h3>
                <p>Em Estoque</p>
            </div>

            <div class="card">
                <h3>${data.vendidos || 0}</h3>
                <p>Vendidos</p>
            </div>

            <div class="card">
                <h3>R$ ${(data.valor_total || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</h3>
                <p>Valor Total</p>
            </div>
        `;
    } catch (error) {
        document.getElementById("cards").innerHTML = "<p style='color:red'>Erro ao conectar com o servidor.</p>";
        console.error("Erro no fetch:", error);
    }
}

function logout() {
    localStorage.removeItem("token");
    window.location.href = "login.html";
}

// Inicia a carga dos dados assim que a pÃ¡gina abre
carregarDashboard();
</script>

</body>
</html>